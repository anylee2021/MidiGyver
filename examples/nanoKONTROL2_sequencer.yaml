global:
    track: 0
    marker: 4
    timer: false
    time: -1
    time_dir: 1.0
    steps: [    [32,0], [33,0], [34,0], [35,0], [36,0], [37,0], [38,0], [39,0],
                [48,0], [49,0], [50,0], [51,0], [52,0], [53,0], [54,0], [55,0],
                [64,0], [65,0], [66,0], [67,0], [68,0], [69,0], [70,0], [71,0]    ]

out:
    -   osc://localhost:4560
    -   csv

pulse:
    -   name: pulse
        interval: 250
        type: scalar
        shape: |
            function() {
                if (global.timer) {
                    global.time += 1

                    var head = global.time % 16;
                    var triggers = [];
                    if (global.steps[head][1] > 0)
                        triggers.push( global.steps[head] );

                    // LED feedback
                    var leds = [];
                    for (i = 0; i < 16; i++) { 
                        if (global.steps[i][1] == 0) {
                            leds.push( [global.steps[i][0], (i === head) ? 127 : 0 ]);
                        }
                    }

                    return { 
                        'nanoKONTROL2*_FEEDBACKLEDS': leds,
                        'nanoKONTROL2*': triggers
                    };
                }
                else
                    return false;
            }

in:
    nanoKONTROL2*:

        -   key: 41
            name: play
            type: toggle
            shape: |
                function() {
                    if (data.value)
                        global.timer = true;
                    else
                        global.timer = false;
                        
                    return value;
                }

        -   name: button
            type: button
            key: [ 32, 33, 34, 35, 36, 37, 38, 39, 48, 49, 50, 51, 52, 53, 54, 55, 64, 65, 66, 67, 68, 69, 70, 71 ]
            shape: |
                function() {
                    if (value > 0) {
                        for (i = 0; i < global.steps.length; i++) {
                            if (global.steps[i][0] == key) {
                                if (global.steps[i][1] == 0) {
                                    global.steps[i][1] = 127;
                                    return global.steps[i][1];
                                }
                                else {
                                    global.steps[i][1] = 0;
                                    return global.steps[i][1];
                                }
                            }
                        }
                    }

                    return false;
                }
